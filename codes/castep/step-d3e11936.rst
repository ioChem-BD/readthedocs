.. _step-d3e11936:

step
====

.. table:: Implementation level

   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | Type                                                                                                                       | Status                                                                                                                     |
   +============================================================================================================================+============================================================================================================================+
   | CML extraction template                                                                                                    | |image1|                                                                                                                   |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | HTML5 representation                                                                                                       | |image2|                                                                                                                   |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+

.. table:: Template attributes

   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | Attribute                                                                                                                  | Value                                                                                                                      |
   +============================================================================================================================+============================================================================================================================+
   | *source*                                                                                                                   | CASTEP log                                                                                                                 |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | id                                                                                                                         | step                                                                                                                       |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | name                                                                                                                       | Geometry optimization step                                                                                                 |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | pattern                                                                                                                    | &#92;s*&#92;={10,}.*$&#92;s*Starting&#92;sLBFGS&#92;siteration.\*                                                          |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | endPattern                                                                                                                 | &#92;s*&#92;={10,}.*$&#92;s*Starting&#92;sLBFGS&#92;siteration.\*                                                          |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | endPattern2                                                                                                                | &#92;s*&#92;={10,}.*$&#92;s*LBFGS:&#92;sFinal&#92;sConfiguration:.\*                                                       |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | endOffset                                                                                                                  | 0                                                                                                                          |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | repeat                                                                                                                     | \*                                                                                                                         |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+
   | xml:base                                                                                                                   | geomopt/step.xml                                                                                                           |
   +----------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------+

.. container:: formalpara-title

   **Input**

::

   --------------------------------------------------------------------------------
    LBFGS: starting iteration         3 with trial guess (lambda=  1.000000)
   --------------------------------------------------------------------------------
    
                              -------------------------------
                                         Unit Cell
                              -------------------------------
           Real Lattice(A)              Reciprocal Lattice(1/A)
        5.5064821     0.0000000     0.0000000        1.141052528  -0.000000000  -0.000000000
        0.0000000     5.5064821     0.0000000       -0.000000000   1.141052528  -0.000000000
        0.0000000     0.0000000     5.5064821       -0.000000000  -0.000000000   1.141052528
    
                          Lattice parameters(A)       Cell Angles
                       a =      5.506482          alpha =   90.000000
                       b =      5.506482          beta  =   90.000000
                       c =      5.506482          gamma =   90.000000
    
                   Current cell volume =           166.963943 A**3
                               density =             1.345680 amu/A**3
                                       =             2.234554 g/cm^3
    
   ------------------------------------------------------------------------ <-- SCF
   SCF loop      Energy           Fermi           Energy gain       Timer   <-- SCF
                                  energy          per atom          (sec)   <-- SCF
   ------------------------------------------------------------------------ <-- SCF
   Initial  -1.36277136E+003  0.00000000E+000                        15.57  <-- SCF
         1  -1.36277138E+003  4.52645708E+000   2.25477017E-006      15.67  <-- SCF
         2  -1.36277138E+003  4.52645708E+000   5.34574840E-009      15.76  <-- SCF
         3  -1.36277138E+003  4.52651175E+000  -9.33087422E-008      15.85  <-- SCF
         4  -1.36277138E+003  4.52689069E+000  -3.37753436E-007      15.95  <-- SCF
         5  -1.36277138E+003  4.52684314E+000   4.91187431E-009      16.04  <-- SCF
   ------------------------------------------------------------------------ <-- SCF
    
   Integrated Spin Density     =   -0.313928E-14 hbar/2                        
   Integrated |Spin Density|   =    0.119664E-09 hbar/2                        
    
   Final energy, E             =  -1362.771379538     eV
   Final free energy (E-TS)    =  -1362.771379538     eV
   (energies not corrected for finite basis set)
    
   NB est. 0K energy (E-0.5TS)      =  -1362.771379538     eV
    
    
    *********** Symmetrised Stress Tensor ***********
    *                                               *
    *          Cartesian components (GPa)           *
    * --------------------------------------------- *
    *             x             y             z     *
    *                                               *
    *  x      0.003277      0.000000      0.000000  *
    *  y      0.000000      0.003277      0.000000  *
    *  z      0.000000      0.000000      0.003277  *
    *                                               *
    *  Pressure:   -0.0033                          *
    *                                               *
    *************************************************
     
    +------------+-------------+-------------+-----------------+ <-- min LBFGS
    |    Step    |   lambda    |   F.delta'  |    enthalpy     | <-- min LBFGS
    +------------+-------------+-------------+-----------------+ <-- min LBFGS
    |  previous  |    0.000000 |    0.001975 |    -1362.754500 | <-- min LBFGS
    | trial step |    1.000000 |   -0.000214 |    -1362.754506 | <-- min LBFGS
    +------------+-------------+-------------+-----------------+ <-- min LBFGS
     
    LBFGS: finished iteration     3 with enthalpy= -1.36275451E+003 eV
     
    +-----------+-----------------+-----------------+------------+-----+ <-- LBFGS
    | Parameter |      value      |    tolerance    |    units   | OK? | <-- LBFGS
    +-----------+-----------------+-----------------+------------+-----+ <-- LBFGS
    |  dE/ion   |   7.256316E-007 |   2.000000E-005 |         eV | Yes | <-- LBFGS
    |   Smax    |   3.277018E-003 |   1.000000E-001 |        GPa | Yes | <-- LBFGS
    +-----------+-----------------+-----------------+------------+-----+ <-- LBFGS
     
    LBFGS: Geometry optimization completed successfully.

   ================================================================================
    LBFGS: Final Configuration:
       

.. container:: formalpara-title

   **Output text**

.. code:: xml

   <comment class="example.output" id="step">
         <module cmlx:templateRef="step">
            <module cmlx:templateRef="scf">
               <list cmlx:templateRef="scftable">
                  <array dataType="xsd:string" dictRef="x:step" size="6">0 1 2 3 4 5</array>
                  <array dataType="xsd:double" dictRef="cc:finalEnergy" size="6" units="nonsi:electronvolt">-1.36277136E+003 -1.36277138E+003 -1.36277138E+003 -1.36277138E+003 -1.36277138E+003 -1.36277138E+003</array>
                  <array dataType="xsd:double" dictRef="ca:efermi" size="6" units="nonsi:electronvolt">0.00000000E+000 4.52645708E+000 4.52645708E+000 4.52651175E+000 4.52689069E+000 4.52684314E+000</array>
               </list>
               <scalar dataType="xsd:double" dictRef="cc:finalEnergy" units="nonsi:electronvolt">-1362.771379538</scalar>
               <scalar dataType="xsd:double" dictRef="cc:freeEnergy" units="nonsi:electronvolt">-1362.771379538</scalar>
               <scalar dataType="xsd:string" dictRef="cc:scfConverged">Geometry optimization completed successfully.</scalar>
            </module>
         </module>
       
       </comment>

.. container:: formalpara-title

   **Template definition**

.. code:: xml

   <templateList>  <template id="scf" pattern="\s*SCF\sloop.*" endPattern="\s*-{10,}.*$\s*">    <record repeat="3" />    <record id="scftable" repeat="*" makeArray="true">{A,x:step}{E,cc:finalEnergy}{E,ca:efermi}.*</record>    <transform process="setValue" xpath=".//cml:array[@dictRef='x:step']" value="$string(replace(., 'Initial', '0'))" />    <transform process="addUnits" xpath=".//cml:array[@dictRef='cc:finalEnergy' or @dictRef='ca:efermi']" value="nonsi:electronvolt" />
           </template>  <template id="energy" pattern="\s*Final\senergy.*" endPattern="\s*">    <record>\s*Final\senergy,\sE\s*={F,cc:finalEnergy}.*</record>    <record>\s*Final\sfree\senergy\s\(E\-TS\)\s*={F,cc:freeEnergy}.*</record>    <transform process="addUnits" xpath=".//cml:scalar" value="nonsi:electronvolt" />
           </template>  <template id="converged" pattern="\s*LBFGS:\s*Geometry\soptimization\scompleted\ssuccessfully.*" endPattern="\s*">    <record>\s*LBFGS:\s{X,cc:scfConverged}</record>      
           </template>                
                       
       </templateList>
   <transform process="move" xpath=".//cml:module[@cmlx:templateRef='energy']//cml:scalar" to=".//cml:module[@cmlx:templateRef='scf']" />
   <transform process="move" xpath=".//cml:module[@cmlx:templateRef='converged']//cml:scalar" to=".//cml:module[@cmlx:templateRef='scf']" />
   <transform process="delete" xpath=".//cml:list[count(*) = 0]" />
   <transform process="delete" xpath=".//cml:list[count(*) = 0]" />
   <transform process="delete" xpath=".//cml:module[count(*) = 0]" />

.. |image1| image:: ../../imgs/Total.png
.. |image2| image:: ../../imgs/Total.png
